---
layout: post
title: "extern声明外部变量"
description: ""
category: 代码人生
tags: [c,extern]
---
{% include JB/setup %}

## 转载 ##
http://www.chsi.com.cn/xy/com/201001/20100118/62031919.html

全局变量(外部变量)是在函数的外部定义的，它的作用域为从变量的定义处开始，到本程序文件的末尾。在此作用域内，全局变量可以为本文件中各个函数所引用。编译时将全局变量分配在静态存储区。

有时需要用extern来声明全局变量，以扩展全局变量的作用域。

　　1. 在一个文件内声明全局变量

　　如果外部变量不在文件的开头定义，其有效的作用范围只限于定义处到文件终了。如果在定义点之前的函数想引用该全局变量，则应该在引用之前用关键字extern对该变量作外部变量声明，表示该变量是一个将在下面定义的全局变量。有了此声明，就可以从声明处起，合法地引用该全局变量，这种声明称为提前引用声明。

　　例4.14 用extern对外部变量作提前引用声明，以扩展程序文件中的作用域。

	　　#include <iostream>

	　　using namespace std;

	　　int max(int,int); //函数声明

	　　void main( )

	　　{extern int a,b; //对全局变量a,b作提前引用声明

	　　cout<<max(a,b)<<endl;

	　　}

	　　int a=15,b=-7; //定义全局变量a,b

	　　int max(int x,int y)

	　　{int z;

	　　z=x>y?x：y;

	　　return z;

	　　}

　　运行结果如下：

　　15

　　在main后面定义了全局变量a，b，但由于全局变量定义的位置在函数main之后，因此如果没有程序的第5行，在main函数中是不能引用全局变量a和b的。现在我们在main函数第2行用extern对a和b作了提前引用声明，表示a和b是将在后面定义的变量。这样在main函数中就可以合法地使用全局变量a和b了。如果不作extern声明，编译时会出错，系统认为a和b未经定义。一般都把全局变量的定义放在引用它的所有函数之前，这样可以避免在函数中多加一个extern声明。

　　2. 在多文件的程序中声明外部变量

　　如果一个程序包含两个文件，在两个文件中都要用到同一个外部变量num，不能分别在两个文件中各自定义一个外部变量num。正确的做法是：在任一个文件中定义外部变量num，而在另一文件中用extern对num作外部变量声明。即

　　extern int num;

　　编译系统由此知道num是一个已在别处定义的外部变量，它先在本文件中找有无外部变量num，如果有，则将其作用域扩展到本行开始(如上节所述)，如果本文件中无此外部变量，则在程序连接时从其他文件中找有无外部变量num，如果有，则把在另一文件中定义的外部变量num的作用域扩展到本文件，在本文件中可以合法地引用该外部变量num。

　　分析下例：

	　　file1.cpp file2.cpp

	　　extern int a,b; int a=3,b=4;

	　　int main( ) ┆

	　　{cout<<a<<″,″<<b<<endl;

	　　return 0;

	　　}

　　用extern扩展全局变量的作用域，虽然能为程序设计带来方便，但应十分慎重，因为在执行一个文件中的函数时，可能会改变了该全局变量的值，从而会影响到另一文件中的函数执行结果。
